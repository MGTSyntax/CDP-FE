// // /assets/js/api.js - Centralized API Handling

// export const API_BASE_URL = 'http://localhost:3100';

// // Fetch Databases
// export async function getDatabases() {
//     try {
//         const response = await fetch(`${API_BASE_URL}/databases`);
//         if (!response.ok) throw new Error('Failed to fetch databases');
//         return await response.json();
//     } catch (error) {
//         console.error('Error fetching databases:', error);
//         return [];
//     }
// }

// // Perform Login Request
// export async function loginUser(database, username, password) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/login`, {
//             method: 'POST',
//             headers: {
//                 'Content-Type': 'application/json',
//             },
//             body: JSON.stringify({ database, username, password }),
//         });

//         if (!response.ok) {
//             const errorData = await response.json();
//             throw new Error(errorData.message || 'Login failed');
//         }
//         return await response.json(); // Token or success response
//     } catch (error) {
//         console.error('Error during login:', error);
//         throw error;
//     }
// }

// // Get User Info by Employee No.
// export async function getUserInfo(db, empNo) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/user-info?db=${db}&empNo=${empNo}`);
//         const data = await response.json();
//         if (!response.ok) {
//             throw new Error(data.error || 'Failed to fetch user info');
//         }
//         return data;
//     } catch (error) {
//         console.error('Error fetching user info:', error);
//         return null;
//     }
// }

// // Fetch complete employee profile by employee number
// export async function getEmpProfile(db, empNo) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/employee-profile?db=${db}&empNo=${empNo}`);
//         const empProfdata = await response.json();
//         if (!response.ok) {
//             throw new Error(empProfdata.error || 'Failed to fetch employee profile');
//         }
//         return empProfdata;
//     } catch (error) {
//         console.error('Error fetching employee profile:', error);
//         return null;
//     }
// }

// // Fetch Departments and Detachments
// export async function getDepartments(selectedDb) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/departments?db=${selectedDb}`);
//         if (!response.ok) throw new Error('Failed to fetch departments');
//         return await response.json();
//     } catch (error) {
//         console.error('Error fetching departments:', error);
//         return [];
//     }
// }

// // Fetch Employees
// export async function getEmployees(selectedDb) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/employees?db=${selectedDb}`);
//         if (!response.ok) throw new Error('Failed to fetch employees');
//         return await response.json();
//     } catch (error) {
//         console.error('Error fetching departments:', error);
//         return [];
//     }
// }

// // Logout API (if needed in the future)
// export async function logout() {
//     try {
//         await fetch(`${API_BASE_URL}/logout`, {
//             method: 'POST',
//         });
//         console.log('Logout successfully');
//     } catch (error) {
//         console.error('Logout failed:', error);
//     }
// }

// // =========================
// // Documents API
// // =========================

// // Fetch documents by department
// export async function getDocuments(department) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/documents/${department}`);
//         if (!response.ok) throw new Error("Failed to fetch documents");
//         return await response.json();
//     } catch (error) {
//         console.error('Error fetching documents:', error);
//         return [];
//     }
// }

// // Upload a new document
// export async function uploadDocument(department, file) {
//     const formData = new FormData();
//     formData.append("document", file);
//     formData.append("department", department);

//     try {
//         const response = await fetch(`${API_BASE_URL}/upload`, {
//             method: "POST",
//             body: formData
//         });

//         const data = await response.json();
//         if (!response.ok) {
//             throw new Error(data.error || 'Upload failed');
//         }
//         return data;
//     } catch (error) {
//         console.error('Error uploading document:', error);
//         throw error;
//     }
// }

// // Delete document
// export async function deleteDocument(department, filename) {
//     try {
//         const response = await fetch(`${API_BASE_URL}/uploads/${department}/${filename}`, {
//             method: "DELETE",
//         });

//         const data = await response.json();
//         if (response.ok) {
//             throw new Error(data.error || 'Delete failed');
//         }
//         return data;
//     } catch (error) {
//         console.error('Error deleting document:', error);
//         throw error;
//     }
// }

// // /assets/js/auth.js

// import { getDatabases, loginUser, getUserInfo } from './api.js';

// document.addEventListener('DOMContentLoaded', async () => {
//     const loginForm = document.querySelector("#loginForm");
//     const dbSelect = document.querySelector("#database");

//     // Populate databases into the select dropdown
//     async function populateDatabases() {
//         const databases = await getDatabases();
//         if (dbSelect) {
//             databases.forEach(db => {
//                 const option = new Option(db.label, db.value);
//                 dbSelect.appendChild(option);
//             });
//         }
//     }
//     // Call populateDatabases when the page loads
//     await populateDatabases();

//     // Handle login form submission
//     loginForm.addEventListener("submit", async (e) => {
//         e.preventDefault();

//         const database = dbSelect.value;
//         const username = document.querySelector("#username").value.trim();
//         const password = document.querySelector("#password").value.trim();

//         if (!database || !username || !password) {
//             alert('All fields are required.');
//             return;
//         }

//         try {
//             // Call API to Login User
//             const result = await loginUser(database, username, password);

//             if (result.success) {
//                 const userInfo = await getUserInfo(database, result.empNo);
//                 if (userInfo) {
//                     const fullUserInfo = {
//                         database,
//                         empNo: userInfo.empNo,
//                         firstName: userInfo.firstName,
//                         lastName: userInfo.lastName,
//                         userLevel: result.userLevel
//                     };

//                     localStorage.setItem('userInfo', JSON.stringify(fullUserInfo));

//                     alert('Login successful.');

//                     const redirectMap = {
//                         superadmin: '/pages/dashboard.html',
//                         hr: '/pages/dashboard.html',
//                         payroll: '/pages/dashboard.html',
//                         adlogistics: '/pages/dashboard.html',
//                         finance: '/pages/dashboard.html',
//                         fieldpersonnel: '/pages/profile.html'
//                     };

//                     const redirectPage = redirectMap[result.userLevel] || '/pages/profile.html';
//                     window.location.href = redirectPage;
//                 } else {
//                     alert('Something went wrong loading user info.');
//                 }
//             } else {
//                 alert('Invalid credentials. Please try again.');
//             }
//         } catch (error) {
//             alert('Login failed: ' + error.message);
//         }
//     });
// });

// // /assets/js/dashboard.js

// import { renderNav } from "./statics/navbar.js";
// import { getEmpProfile } from "./api.js";

// document.addEventListener('DOMContentLoaded', () => {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));

//     if (!userInfo) {
//         console.error("No user data found in local storage.");
//         window.location.href = '/pages/login.html'; // redirect if not logged in
//         return;
//     }

//     // Render nav
//     renderNav(userInfo);

//     // Get top profile record
//     loadProfile();
// });

// async function loadProfile() {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));
//     if (!userInfo) return;

//     const profile = await getEmpProfile(userInfo.database, userInfo.empNo);
//     if (profile && profile.basicInfo) {
//         const basicInfoENum = document.getElementById("bi_empNo");
//         if (basicInfoENum) basicInfoENum.textContent = profile.basicInfo.ji_empNo || '';

//         const biFullName = document.getElementById("bi_fullname");
//         if (biFullName) {
//             const lname = profile.basicInfo.ji_lname || '';
//             const extname = profile.basicInfo.ji_extname ? `${profile.basicInfo.ji_extname}` : '';
//             const fname = profile.basicInfo.ji_fname || '';
//             const mname = profile.basicInfo.ji_mname ? ` ${profile.basicInfo.ji_mname}` : '';

//             biFullName.textContent = `${lname}${extname}, ${fname}${mname}`;
//         }

//         const eaEmailAdd = document.getElementById("email_add");
//         if (eaEmailAdd) eaEmailAdd.textContent = profile.emailaddInfo.email_add || '';

//         const jiPosition = document.getElementById("ji_pos");
//         if (jiPosition) jiPosition.textContent = profile.jobInfo.ji_pos || '';

//     }

// }

// // /assets/js/dashboard.js

// import { renderNav } from "./statics/navbar.js";
// import { getEmpProfile } from "./api.js";

// document.addEventListener('DOMContentLoaded', () => {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));

//     if (!userInfo) {
//         console.error("No user data found in local storage.");
//         window.location.href = '/pages/login.html'; // redirect if not logged in
//         return;
//     }

//     // Render nav
//     renderNav(userInfo);

//     // Get top profile record
//     loadProfile();
// });

// async function loadProfile() {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));
//     if (!userInfo) return;

//     const profile = await getEmpProfile(userInfo.database, userInfo.empNo);
//     if (profile && profile.basicInfo) {
//         const basicInfoENum = document.getElementById("bi_empNo");
//         if (basicInfoENum) basicInfoENum.textContent = profile.basicInfo.ji_empNo || '';

//         const biFullName = document.getElementById("bi_fullname");
//         if (biFullName) {
//             const lname = profile.basicInfo.ji_lname || '';
//             const extname = profile.basicInfo.ji_extname ? `${profile.basicInfo.ji_extname}` : '';
//             const fname = profile.basicInfo.ji_fname || '';
//             const mname = profile.basicInfo.ji_mname ? ` ${profile.basicInfo.ji_mname}` : '';

//             biFullName.textContent = `${lname}${extname}, ${fname}${mname}`;
//         }

//         const eaEmailAdd = document.getElementById("email_add");
//         if (eaEmailAdd) eaEmailAdd.textContent = profile.emailaddInfo.email_add || '';

//         const jiPosition = document.getElementById("ji_pos");
//         if (jiPosition) jiPosition.textContent = profile.jobInfo.ji_pos || '';

//     }

// }

// // /assets/js/documents.js
// import { getDocuments, uploadDocument, deleteDocument, API_BASE_URL } from './api.js';

// const documentList = document.getElementById("document-list");
// const uploadBtn = document.getElementById("uploadBtn");
// const fileInput = document.getElementById("docsUpload");

// let activeDepartment = "AnL";
// let documents = [];

// const selectedDb = localStorage.getItem("selectedDb");

// // Fetch and render documents
// async function loadDocuments() {
//     try {
//         documents = await getDocuments(activeDepartment);
//         renderDocuments();
//     } catch (err) {
//         console.error("Load documents error:", err);
//         documentList.innerHTML = `<p class="no-docs">Failed to load documents</p>`;
//     }
// }

// function renderDocuments() {
//     documentList.innerHTML = "";

//     if (!documents || documents.length === 0) {
//         documentList.innerHTML = `<p class="no-docs">No documents uploaded yet</p>`;
//         return;
//     }

//     documents.forEach((doc, index) => {
//         const item = document.createElement("div");
//         item.classList.add("document-item");

//         item.innerHTML = `
//             <span class="icon"><i class="fa-solid fa-file"></i></span>
//             <div class="info">
//                 <strong><a href="${API_BASE_URL}${doc.path}" target="_blank">${doc.filename}</a></strong>
//                 <small>Uploaded: ${new Date(doc.upload_date).toLocaleDateString()} by ${doc.uploaded_by}</small>
//             </div>
//             <div class="actions">
//                 <button class="delete-btn" data-index="${index}"><i class="fa fa-trash"></i></button>
//             </div>
//         `;
//         documentList.appendChild(item);
//     });

//     // Attach delete actions
//     document.querySelectorAll(".delete-btn").forEach(btn =>
//         btn.addEventListener("click", async (e) => {
//             const index = e.currentTarget.dataset.index;
//             const doc = documents[index];

//             try {
//                 await deleteDocument(doc.department, doc.filename);
//                 await loadDocuments();
//             } catch (err) {
//                 console.error("Delete error:", err);
//                 alert("Error deleting file");
//             }
//         })
//     );
// }

// uploadBtn.addEventListener("click", () => fileInput.click());

// fileInput.addEventListener("change", async () => {
//     const file = fileInput.files[0];
//     if (!file) return;

//     try {
//         await uploadDocument(activeDepartment, file);
//         await loadDocuments();
//     } catch (err) {
//         console.error('Upload failed:', err);
//         alert('Upload failed: ' + err.message);
//     } finally {
//         fileInput.value = '';
//     }
// });

// // Department selection
// document.querySelectorAll(".department-list li").forEach(li => {
//     li.addEventListener("click", () => {
//         document.querySelector(".department-list li.active")?.classList.remove("active");
//         li.classList.add("active");
//         activeDepartment = li.textContent.trim();
//         loadDocuments();
//     });
// });

// // Initial load
// loadDocuments();

// // /assets/js/profile.js
// import { renderNav } from "./statics/navbar.js";
// import { getEmpProfile } from "./api.js";

// document.addEventListener('DOMContentLoaded', () => {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));

//     if (!userInfo) {
//         console.error("No user data found in local storage.");
//         window.location.href = '/pages/login.html'; // redirect if not logged in
//         return;
//     }

//     // Render nav
//     renderNav(userInfo);

//     loadProfile();
// });

// async function loadProfile() {
//     const userInfo = JSON.parse(localStorage.getItem('userInfo'));
//     if (!userInfo) return;

//     const profile = await getEmpProfile(userInfo.database, userInfo.empNo);

//     if (!profile || !profile.basicInfo) {
//         console.error('Failed to load profile data.');
//         return;
//     }

//     // Basic Info
//     const basicInfoENum = document.getElementById("bi_empNo");
//     if (basicInfoENum) basicInfoENum.textContent = profile.basicInfo.ji_empNo || '';

//     const biFullName = document.getElementById("bi_fullname");
//     if (biFullName) {
//         const lname = profile.basicInfo.ji_lname || '';
//         const extname = profile.basicInfo.ji_extname ? `${profile.basicInfo.ji_extname}` : '';
//         const fname = profile.basicInfo.ji_fname || '';
//         const mname = profile.basicInfo.ji_mname ? ` ${profile.basicInfo.ji_mname}` : '';

//         biFullName.textContent = `${lname}${extname}, ${fname}${mname}`;
//     }

//     // Email Address
//     const eaEmailAdd = document.getElementById("email_add");
//     if (eaEmailAdd) eaEmailAdd.textContent = profile.emailaddInfo.email_add || '';
    
//     // Personal Info
//     const piAddress = document.getElementById("pi_add");
//     if (piAddress) piAddress.textContent = profile.personalInfo.pi_add || '';

//     const piContactNo = document.getElementById("pi_tel");
//     if (piContactNo) piContactNo.textContent = profile.personalInfo.pi_tel || '';

//     const piNationality = document.getElementById("pi_nationality");
//     if (piNationality) piNationality.textContent = profile.personalInfo.pi_nationality || '';

//     const piSex = document.getElementById("pi_sex");
//     if (piSex) piSex.textContent = profile.personalInfo.pi_sex || '';

//     const piCStatus = document.getElementById("pi_cstatus");
//     if (piCStatus) piCStatus.textContent = profile.personalInfo.pi_cstatus || '';

//     const piBirthdate = document.getElementById("pi_dbirth");
//     if (piBirthdate) piBirthdate.textContent = profile.personalInfo.pi_dbirth || '';

//     const piReligion = document.getElementById("pi_religion");
//     if (piReligion) piReligion.textContent = profile.personalInfo.pi_religion || '';

//     const piSSSNo = document.getElementById("pi_sssno");
//     if (piSSSNo) piSSSNo.textContent = profile.personalInfo.pi_sssno || '';

//     const piTIN = document.getElementById("pi_tin");
//     if (piTIN) piTIN.textContent = profile.personalInfo.pi_tin || '';

//     const piPHIC = document.getElementById("pi_philhealth");
//     if (piPHIC) piPHIC.textContent = profile.personalInfo.pi_philhealth || '';

//     const piPagibig = document.getElementById("pi_pagibig");
//     if (piPagibig) piPagibig.textContent = profile.personalInfo.pi_pagibig || '';

//     // Job Info
//     const jiDepartment = document.getElementById("ji_dept");
//     if (jiDepartment) jiDepartment.textContent = profile.jobInfo.ji_dept || '';

//     const jiClient = document.getElementById("ji_sec");
//     if (jiClient) jiClient.textContent = profile.jobInfo.ji_sec || '';

//     const jiPosition = document.getElementById("ji_pos");
//     if (jiPosition) jiPosition.textContent = profile.jobInfo.ji_pos || '';

//     const jiJobStatus = document.getElementById("ji_jobStat");
//     if (jiJobStatus) jiJobStatus.textContent = profile.jobInfo.ji_jobStat || '';

//     const jiDateHired = document.getElementById("ji_dateHired");
//     if (jiDateHired) jiDateHired.textContent = profile.jobInfo.ji_dateHired || '';
// }

// // /assets/js/script.js
// import { getDatabases, getDepartments, getEmployees } from './api.js';

// document.addEventListener('DOMContentLoaded', async () => {
//     // For detachments
//     const dbSelect = document.querySelector('#dbSelect');
//     const viewDataBtn = document.querySelector('#fetchDB');

//     let detachmentsData = [];
//     const detachmentsCol = ['dept_code', 'dept_name', 'sec_code', 'sec_name'];

//     // For employees
//     const dbSelectForEmp = document.querySelector('#dbSelectforEmp');
//     const viewDataBtnforEmp = document.querySelector('#fetchDBforEmp');

//     let employeeData = [];
//     const employeesCol = ['emp_code', 'emp_name', 'empsec_code', 'empsec_name'];

//     const tableBody = document.querySelector('#departmentsTable tbody');
//     const searchInput = document.querySelector('#searchInput');
//     const paginationControls = document.querySelector('#paginationControls');

//     let currentPage = 1;
//     let currentData = [];
//     let currentColumns = [];
//     let itemsPerPage = getItemsPerPage();

//     function getItemsPerPage() {
//         const screenHeight = window.innerHeight;
//         if (screenHeight <= 653) {
//             return 10;
//         } else if (screenHeight > 653 && screenHeight <= 965) {
//             return 20;
//         } else {
//             return 25;
//         }
//     }

//     // Fetch and Populate Databases for Selection
//     async function populateDatabases() {
//         const databases = await getDatabases();

//         if (dbSelect) {
//             databases.forEach(db => {
//                 const option1 = new Option(db.label, db.value);
//                 dbSelect.appendChild(option1);
//             });
//         }

//         if (dbSelectForEmp) {
//             databases.forEach(db => {
//                 const option2 = new Option(db.label, db.value);
//                 dbSelectForEmp.appendChild(option2);
//             });
//         }
//     }

//     // Load Databases on Page Load
//     await populateDatabases();

//     // Click View Button to Fetch Departments and Detachments from Backend API
//     if (viewDataBtn) {
//         viewDataBtn.addEventListener('click', async () => {
//             const selectedDb = dbSelect.value;
//             if (!selectedDb) {
//                 alert('Please select database.');
//                 return;
//             }

//             detachmentsData = await getDepartments(selectedDb);
//             currentData = detachmentsData;
//             currentColumns = detachmentsCol;
//             currentPage = 1;
//             renderTable();
//             setupPagination(detachmentsData.length);
//             searchInput.value = '';
//         });
//     }

//     // Click View Button to Fetch Employees from Backend API
//     if (viewDataBtnforEmp) {
//         viewDataBtnforEmp.addEventListener('click', async () => {
//             const selectedDbEmp = dbSelectForEmp.value;
//             if (!selectedDbEmp) {
//                 alert('Please select database.');
//                 return;
//             }

//             employeeData = await getEmployees(selectedDbEmp);
//             currentData = employeeData;
//             currentColumns = employeesCol;
//             currentPage = 1;
//             renderTable();
//             setupPagination(employeeData.length);
//         });
//     }
    
//     // Search results
//     searchInput.value = '';
//     searchInput.addEventListener('input', () => {
//         const searchItem = searchInput.value.toLowerCase();
//         const filteredData = currentData.filter(item =>
//             item[currentColumns[1]].toLowerCase().includes(searchItem) ||
//             (item[currentColumns[3]] && item[currentColumns[3]].toLowerCase().includes(searchItem))
//         );
//         currentPage = 1;
//         renderTable(filteredData);
//         setupPagination(detachmentsData.length);
//     });

//     // Render Table Data
//     function renderTable(data = currentData) {
//         tableBody.innerHTML = '';

//         const startIndex = (currentPage - 1) * itemsPerPage;
//         const endIndex = startIndex + itemsPerPage;
//         const pageData = data.slice(startIndex, endIndex);

//         if (pageData.length === 0) {
//             tableBody.innerHTML = '<td colspan="4">No results found.</td>';
//             return;
//         }

//         pageData.forEach(item => {
//             const row = document.createElement('tr');
//             row.innerHTML = currentColumns.map(col => `<td>${item[col] || ''}</td>`).join('');
//             tableBody.appendChild(row);
//         });
//     }

//     // Pagination Setup
//     function setupPagination(totalItems) {
//         paginationControls.innerHTML = '';
//         const totalPages = Math.ceil(totalItems / itemsPerPage);

//         // Curent page of Last page summary
//         const pageSummary = document.createElement('span');
//         pageSummary.textContent = `Page ${currentPage} of ${totalPages}`;
//         paginationControls.appendChild(pageSummary);

//         if (currentPage > 1) {
//             paginationControls.appendChild(createPaginationButton('<<', () => { goToPage(1); }));
//             paginationControls.appendChild(createPaginationButton('<', () => { goToPage(currentPage -1); }));
//         }

//         if (currentPage < totalPages) {
//             paginationControls.appendChild(createPaginationButton('>', () => { goToPage(currentPage + 1); }));
//             paginationControls.appendChild(createPaginationButton('>>', () => { goToPage(totalPages); }));
//         }
//     }
        
//     function createPaginationButton(text, onClick) {
//         const button = document.createElement('button');
//         button.textContent = text;
//         button.classList.add('pagination-button');
//         button.addEventListener('click', onClick);
//         return button;
//     }

//     function goToPage(page) {
//         currentPage = page;
//         renderTable();
//         setupPagination(currentData.length);
//     }
// });